{% extends 'base.html' %}
{% block title %}Stock Prediction{% endblock %}
{% block content %}
<h2 class="mb-3">Stock Prediction</h2>
<p>Choose a stock and provide closing price and news text to get a price prediction and view the price chart.</p>

<form method="post" action="/predict" class="mb-4">
    <div class="mb-3">
        <label for="ticker" class="form-label">Stock Ticker</label>
        <select class="form-select" id="ticker" name="ticker" required>
            <option value="">Select a ticker</option>
           {% for t in tickers %}
  {% set selected = 'selected' if t == request.form.get('ticker') else '' %}
  <option value="{{ t }}" {{ selected }}>{{ t }}</option>
{% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="price" class="form-label">Closing Price</label>
        <input type="number" step="0.01" class="form-control" id="price" name="price" placeholder="e.g. 4000" value="{{ prediction.price if prediction else '' }}" required>
    </div>
    <div class="mb-3">
        <label for="news" class="form-label">News Text</label>
        <textarea class="form-control" id="news" name="news" rows="3" placeholder="Enter relevant news" required>{{ prediction.news if prediction else '' }}</textarea>
    </div>
    <button type="submit" class="btn btn-primary">Predict</button>
</form>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

{% if prediction %}
<div class="alert alert-success">
    <h5>Prediction Result</h5>
    <ul>
        <li><strong>Stock:</strong> {{ prediction.ticker }}</li>
        <li><strong>Input Price:</strong> ${{ prediction.price }}</li>
        <li><strong>News:</strong> {{ prediction.news }}</li>
        <li><strong>Predicted Closing Price:</strong> ${{ prediction.predicted_price }}</li>
    </ul>
</div>
{% endif %}

{% if plot_json %}
<div id="price-plot" style="margin-top: 30px;"></div>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    var plotly_data = {{ plot_json|safe }};
    Plotly.newPlot('price-plot', plotly_data.data, plotly_data.layout);
</script>
{% endif %}
{% endblock %}
