{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- Hero Cards: Top Gainer & Top Loser -->
<div class="row gx-4 mb-3">
  <div class="col-12 col-md-6 mb-2">
    <div class="card hero-kpi border-success h-100 d-flex flex-row align-items-center kpi-gradient-green">
      <div class="display-4 text-success px-4"><i class="bi bi-arrow-up-circle-fill"></i></div>
      <div class="py-3">
        <h6 class="text-uppercase text-muted">Top Gainer</h6>
        <div class="h4 mb-0">{{ gainers[0].ticker }}</div>
        <div class="fs-5 fw-bold text-success">{{ gainers[0].change }}</div>
        <small>{{ gainers[0].name }}</small>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6 mb-2">
    <div class="card hero-kpi border-danger h-100 d-flex flex-row align-items-center kpi-gradient-red">
      <div class="display-4 text-danger px-4"><i class="bi bi-arrow-down-circle-fill"></i></div>
      <div class="py-3">
        <h6 class="text-uppercase text-muted">Top Loser</h6>
        <div class="h4 mb-0">{{ losers[0].ticker }}</div>
        <div class="fs-5 fw-bold text-danger">{{ losers[0].change }}</div>
        <small>{{ losers[0].name }}</small>
      </div>
    </div>
  </div>
</div>

<!-- Mini Chipped Cards for Other Movers -->
<div class="row mb-1">
  <div class="col-12">
    <span class="fw-bold me-2">Other Gainers:</span>
    {% for s in gainers[1:] %}
      <span class="badge bg-success me-1">{{s.ticker}} {{s.change}}</span>
    {% endfor %}
    <span class="fw-bold mx-3">Other Losers:</span>
    {% for s in losers[1:] %}
      <span class="badge bg-danger me-1">{{s.ticker}} {{s.change}}</span>
    {% endfor %}
  </div>
</div>

<!-- Summary Metrics Cards Row -->
<div class="row gx-4 mb-4">
  {% for metric in metrics %}
  <div class="col-6 col-lg-3 d-flex">
    <div class="card metric-card p-3 w-100 text-center metric-card-accent-{{ loop.index }}">
      <i class="bi {{ metric.icon }} display-6 mb-1 icon-gradient"></i>
      <div class="fs-6 text-muted mb-1">{{ metric.label }}</div>
      <div class="fs-4 fw-semibold">{{ metric.value }}</div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- AI Predictions Cards Row -->
<div class="row gx-4 mb-3">
  {% for pred in predictions %}
  <div class="col-12 col-md-3 mb-3 d-flex">
    <div class="card ai-prediction-card p-3 w-100 text-center flex-fill ai-card-gradient">
      <div class="fw-bold fs-5 mb-1">{{ pred.ticker }}</div>
      <div class="fs-3">${{ "%.2f"|format(pred.price) }}
        <span class="fs-6 text-muted">({{ pred.actual }})</span>
      </div>
      <span class="badge {{ 'bg-success' if pred.percent >= 0 else 'bg-danger' }}">
        {{ '+' if pred.percent >=0 else ''}}{{ pred.percent }}%
      </span>
      <div class="small mt-1 text-muted">AI Predicted Price</div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Main Feature Cards Row -->
<div class="row gx-4 mb-4">
  <div class="col-12 col-lg-3 mb-3 d-flex">
    <div class="card tool-card h-100 text-center tool-gradient-prediction" onclick="location.href='/predict'">
      <div class="card-body d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-bar-chart-fill fs-1 text-primary mb-2 icon-gradient"></i>
        <h5>Stock Prediction</h5>
        <p class="text-muted small">Use AI to predict closing prices instantly.</p>
        <a href="/predict" class="btn btn-outline-primary btn-sm mt-auto">Open</a>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3 mb-3 d-flex">
    <div class="card tool-card h-100 text-center tool-gradient-analysis" onclick="location.href='/analyze'">
      <div class="card-body d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-bar-chart-steps fs-1 text-info mb-2 icon-gradient"></i>
        <h5>Combined Analysis</h5>
        <p class="text-muted small">Blend charts and sentiment for insights.</p>
        <a href="/analyze" class="btn btn-outline-primary btn-sm mt-auto">Open</a>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3 mb-3 d-flex">
    <div class="card tool-card h-100 text-center tool-gradient-sentiment" onclick="location.href='/sentiment'">
      <div class="card-body d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-emoji-smile fs-1 text-warning mb-2 icon-gradient"></i>
        <h5>News Sentiment</h5>
        <p class="text-muted small">Classify news as bullish or bearish.</p>
        <a href="/sentiment" class="btn btn-outline-primary btn-sm mt-auto">Open</a>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-3 mb-3 d-flex">
    <div class="card tool-card h-100 text-center tool-gradient-chat" onclick="location.href='/chat'">
      <div class="card-body d-flex flex-column align-items-center justify-content-center">
        <i class="bi bi-chat-dots fs-1 text-success mb-2 icon-gradient"></i>
        <h5>AI Chatbot</h5>
        <p class="text-muted small">Ask any stock or sentiment question.</p>
        <a href="/chat" class="btn btn-outline-primary btn-sm mt-auto">Open</a>
      </div>
    </div>
  </div>
</div>

<!-- Stock List and Watchlist -->
<div class="row gx-4">
  <div class="col-12 col-lg-8 mb-3 d-flex">
    <div class="card big-card flex-fill h-100 table-gradient">
      <div class="card-header">Stock List</div>
      <div class="card-body scroll-table p-0">
        <table class="table table-striped mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <th>Ticker</th>
              <th>Name</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            {% for stock in stock_list %}
            <tr>
              <td>{{ stock.ticker }}</td>
              <td>{{ stock.name }}</td>
              <td>${{ stock.price }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-4 mb-3 d-flex">
    <div class="card big-card flex-fill h-100 table-gradient">
      <div class="card-header">Watchlist</div>
      <div class="card-body scroll-table p-0">
        <table class="table table-striped mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <th>Ticker</th>
              <th>Name</th>
              <th>Price</th>
            </tr>
          </thead>
          <tbody>
            {% for stock in watchlist %}
            <tr>
              <td>{{ stock.ticker }}</td>
              <td>{{ stock.name }}</td>
              <td>${{ stock.price }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
